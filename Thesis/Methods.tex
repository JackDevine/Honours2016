In order to see how these equations behave with time, we have to resort to numerical methods (see section \ref{numerics}). However we note that for a given potential there will be a stationary solution that we will refer to as the ``steady state'', given periodic boundary conditions, we will give an analytical form for this steady state.

\section{Steady state solution} \label{SteadyState}
In the steady state, we have:

\begin{eqnarray}
\frac{\partial P(x, t)}{\partial t} &=&  0 \ = \ \frac{\partial J}{\partial x} \label{eqn:SmoluchowskiSteady} \\
\frac{\partial T(x, t)}{\partial t} &=& 0 \ = \ \frac{\partial}{\partial x} \left ( -\kappa q(x, t) + D \frac{\partial T(x, t)}{\partial x} \right ) \label{eqn:TemperatureSteady}
\end{eqnarray}

Suppose that we have periodic boundary conditions such that $P(x = 0) = P(x = L)$,  $J(x = 0) = J(x = L)$ and $T(x = 0) = T_0 = T(x = L)$ where $L$ is the size of one period and $T_0$ is the temperature of the bath (room temperature). Section 5.2 of \cite{Gardiner2009} gives the steady state current as:

\begin{equation}
J_s = \left [\frac{2 k_B T(L)}{\psi(L)} - \frac{2 k_B T(0)}{\psi(0)}  \right] P_s(0) \left [\int_0^L dx'/\psi(x') \right]^{-1}
\label{eqn:SteadyCurrent}
\end{equation}

with $\psi(x) \equiv \exp[-\int_0^x dx' \frac{\partial_x V(x')}{2 k_B T(x')}]$. Meanwhile, the density is:

\begin{equation}
P_s(x) = P_s(0) \left [\frac{\int_0^x \frac{dx'}{\psi(x')} \frac{T(L)}{\psi(L)} + \int_x^L \frac{dx'}{\psi(x')} \frac{T(0)}{\psi(0)} }{\frac{T(x)}{\psi(x)} \int_0^L \frac{dx'}{\psi(x')} } \right]
\label{eqn:SteadyDensity}
\end{equation}
In this case, $J_s$ is a constant and $P_s(0)$ is also a constant. Assuming that we know these constants it is now possible to find the steady state temperature. We have:

\begin{equation}
\frac{\partial T}{\partial t} = 0 =  \partial_x S_s = \kappa \partial_x V J_s - D \frac{\partial T}{\partial x}
\end{equation}
Rearranging, we find
\begin{equation}
\frac{\partial T}{\partial x} = \frac{\kappa \partial_x V J_s - \partial_x S_s}{D}
\end{equation}
Integrating both sides:
\begin{equation}
\int_0^L \frac{\partial T}{\partial x} dx = T(L) - T(0) = 0 = \frac{\kappa J_s}{D} \int_0^L \partial_x V dx - \frac{S_s}{D}L
\end{equation}

Noticing that $V(x) = v_0(x) + f x$, where $v_0(0) = v_0(L)$, we get $\int_0^L \partial_x V dx = f L$, so

\begin{equation}
S_s = \kappa J_s f
\end{equation}

and

\begin{equation}
T(x) = T(0) + \frac{\kappa J_s}{D} \int_0^x \partial_x V dx - \frac{S_s}{D}x = T(0) + \frac{\kappa J_s}{D} (v_0(x) - v_0(0)) \label{eqn:SteadyTemperature}
\end{equation}

It would seem that one should be able to calculate the steady state current and density directly from the equations shown above. However, we notice that the constants $J_s$ and $P_s(0)$ have to satisfy equations (\ref{eqn:SteadyCurrent}), (\ref{eqn:SteadyDensity}) and (\ref{eqn:SteadyTemperature}) while also satisfying the normalization condition $\int_0^L P(x) dx = 1$. To do this we define an objective function given by

\begin{equation}
obj(J_s, P_s(0)) = \left (J_s - \left [\frac{2 k_B T(L)}{\psi(L)} - \frac{2 k_B T(0)}{\psi(0)}  \right] P_s(0) \left [\int_0^L dx'/\psi(x') \right]^{-1} \right)^2  \label{eqn:Objective}
\end{equation}

And we minimize this objective function with respect to $J_s$ and $P_s(0)$ under the constraint $\int_0^L P(x) dx = 1$. Another way to do this is to guess a steady state density and temperature and use finite differencing to simulate forward in time until the transients die out.

%----------------------------------------------------------------------------------------
%	NUMERICS
%----------------------------------------------------------------------------------------

\section{Numerical simulation} \label{numerics}

\subsection{Finite differences}
The one dimensional equation can be solved on a discrete grid by using the finite differences method, the main idea behind this strategy is to approximate derivatives with equations of the form:

\begin{equation}
\frac{d f}{d x} \approx \frac{f(x - h) - f(x + h)}{2h}
\end{equation}

for some small $h$. The Crank Nicolson scheme uses a forward finite differences step and a backwards one, it is very accurate, however we will find that it is a little weird for non linear equations. From now on, we will use the notation that $F(j \Delta x, n \Delta t) = F_j^n$, the key equation for the Crank Nicolson scheme is:
\begin{equation}
\frac{P_j^{n+1} - P_j^n}{\Delta t} = \frac{1}{2}(F_j^{n+1} - F_j^n)
\end{equation}
where $F$ represents the right hand side of the equation that we are doing finite differences on. By applying finite differences, we find that:
\begin{multline}
F_j^{n+1} = P_j \frac{V_{j+1}^{n+1} - 2V_j^{n+1} + V_{j-1}^{n+1}}{\Delta x^2} + \frac{P_{j+1}^{n+1} - P_{j-1}^{n+1}}{2 \Delta x^2} \frac{V_{j+1}^{n+1} - V_{j-1}^{n+1}}{2 \Delta x^2} \\
+ \frac{T_{j+1}^{n+1} P_{j+1}^{n+1} - 2T_{j}^{n+1} P_{j}^{n+1} + T_{j-1}^{n+1} P_{j-1}^{n+1}}{\Delta x^2}
\end{multline}
We make the following definitions:
\begin{align*}
r  &\equiv \frac{\Delta t}{2 \Delta x^2} \\
a^{n+1} &= r \left(\frac{1}{4}(V_{j+1}^{n+1} - V_{j-1}^{n+1}) - T_{j-1}^{n+1} \right) \\
b^{n+1} &= 1 + r \left(2 T_j^{n+1} - (V_{j+1}^{n+1} - 2V_j^{n+1} + V_{j-1}^{n+1}) \right) \\
c^{n+1} &= -r\left(\frac{1}{4}(V_{j+1}^{n+1} - V_{j-1}^{n+1}) - T_{j+1}^{n+1}\right) \\
a^n &= -r \left(\frac{1}{4}(V_{j+1}^{n} - V_{j-1}^{n}) - T_{j-1}^{n} \right) \\
b^n &= 1 - r \left(2 T_j^{n} - (V_{j+1}^{n} - 2V_j^{n} + V_{j-1}^{n}) \right) \\
c^n &= r \left(\frac{1}{4}(V_{j+1}^{n} - V_{j-1}^{n}) - T_{j+1}^{n}\right) \numberthis
\end{align*}
With these definitions, the Crank Nicolson scheme can be written down as follows:
\begin{multline}
P_{j-1}^{n+1} a^{n+1} + P_j^{n+1} b^{n+1} + P_{j+1}^{n+1} c^{n+1} = P_{j-1}^{n} a^n
+ P_j^{n} b^n + P_{j+1}^{n} c^n
\end{multline}
This equation can be written in matrix form by defining the following matrices:
\begin{equation}
A = 
\begin{bmatrix}
	a_0^{n+1} & b_1^{n+1} & 0                & 0                & 0        & \dots                                 & 0        \\
	c_0^{n+1} & a_1^{n+1} & b_2^{n+1} & 0                & 0        & \dots                                 & 0        \\
	0                & c_1^{n+1} & a_2^{n+1} & b_3{n+1}   & 0        & \dots                                 & 0        \\
			     &                   &                   &                  &           &                                         &           \\       
	\vdots         & \vdots         & \ddots         & \ddots         & \ddots & \vdots                              & \vdots \\
			     &                   &                   &                  &           &                                         &           \\
			     &                   &                   &                  &           &                                         &           \\
	0                &                   & \dots           &                   &  c_{J-2}^{n+1} & a_{J-1}^{n+1}  & b_J^{n+1} \\
	0                &                   & \dots           &                   &                         &  c_{J-1}^{n+1} & a_J^{n+1}
\end{bmatrix}
,\quad P^{n+1} =
\begin{bmatrix}
P_0^{n+1}       \\
P_1^{n+1}	     \\
                        \\
                        \\
\vdots               \\
                        \\
                        \\
P_{J-1}^{n+1} \\
P_J^{n+1}
\end{bmatrix}
\end{equation}

\begin{equation}
B = 
\begin{bmatrix}
	a_0^{n} & b_1^{n}     & 0                 & 0          & 0                    & \dots            & 0        \\
	c_0^{n} & a_1^{n}     & b_2^{n}      & 0          & 0                    & \dots            & 0        \\
	0                & c_1^{n} & a_2^{n}      & b_3{n} & 0                    & \dots            & 0        \\
			     &               &                   &             &                      &                     &           \\
	\vdots         & \vdots     & \ddots         & \ddots   & \ddots            & \vdots           & \vdots \\
			     &               &                   &             &                      &                     &           \\
			     &               &                   &             &                      &                     &           \\
	0                &               & \dots           &             &  c_{J-2}^{n} & a_{J-1}^{n}  & b_J^{n} \\
	0                &               & \dots           &             &                     &  c_{J-1}^{n} & a_J^{n}
\end{bmatrix}
,\quad P^{n} =
\begin{bmatrix}
P_0^{n}       \\
P_1^n          \\
                    \\
                    \\
\vdots           \\
                    \\
                    \\
P_{J-1}^{n} \\
P_J^{n}
\end{bmatrix}
\end{equation}
With these matrices the equation now becomes $A \cdot P^{n+1} = B \cdot P^n$, this equation can be used to step forward $P$.
Each time that we step forward using this equation we will be out by a factor, this means that at each step we will need to renormalize using the equation $\int P(x) dx = 1$.

Likewise, we can apply the Crank Nicolson scheme to the heat equation, the discretized version of equation \ref{eqn:TemperatureEvolution} is given by:

\begin{multline}
T_{j-1}^{n+1} \left [\frac{-r \alpha}{4}P_{j-1}^{n+1}(V_{j+1}^{n+1} - V_{j-1}^{n+1}) - r \beta \right]
+ T_j^{n+1} \left[1 + 2 r \beta P_j^{n+1} \right] \\
+T_{j+1}^{n+1} \left [\frac{r \alpha}{4} P_{j+1}^{n+1}(V_{j+1}^{n+1} - V_{j-1}^{n+1}) - r \beta \right]
+\frac{r \alpha}{4} P_{j}^{n+1} \left(V_{j+1}^{n+1} - V_{j-1}^{n+1} \right) \\
 = T_{j-1}^{n} \left [\frac{r \alpha}{4}P_{j-1}^{n}(V_{j+1}^{n} - V_{j-1}^{n}) + r \beta \right ] + T_j^{n} \left[1 - 2 r \beta P_j^{n} \right] \\
+T_{j+1}^{n} \left [\frac{-r \alpha}{4} P_{j+1}^{n}(V_{j+1}^{n} - V_{j-1}^{n}) + r \beta \right]
-\frac{r \alpha}{4} P_{j}^{n} \left(V_{j+1}^{n} - V_{j-1}^{n} \right)
\end{multline}

These equations are correct for points inside the boundaries, but for $j = 0$ and $j = J$, they involve points that are outside of the domain. For the temperature, we will impose Neumann boundary conditions unlike the periodic boundary conditions that we have for the probability distribution. By taking a backward difference at the left boundary and a forward difference at the right boundary, we have $T_{-1} = T_0$, $T_J = T_{J+1}$. So, for these values of $j$, the equations become:

\begin{multline}
T_0^{n+1} \left [\frac{-r \alpha}{4}P_J^{n+1}(V_1^{n+1} - V_{-1}^{n+1}) - r \beta \right] + T_0^{n+1} \left[1 + 2 r \beta P_0^{n+1} \right] \\
+T_{1}^{n+1} \left [\frac{r \alpha}{4} P_{1}^{n+1}(V_{1}^{n+1} - V_{-1}^{n+1}) - r \beta \right]
+\frac{r \alpha}{4} P_{0}^{n+1} \left(V_{1}^{n+1} - V_{-1}^{n+1} \right) \\
 = T_{0}^{n} \left [\frac{r \alpha}{4}P_{J}^{n}(V_{1}^{n} - V_{-1}^{n}) + r \beta \right ] + T_0^{n} \left[1 - 2 r \beta P_0^{n} \right]
+T_{1}^{n} \left [\frac{-r \alpha}{4} P_{1}^{n}(V_{1}^{n} - V_{-1}^{n}) + r \beta \right] \\
-\frac{r \alpha}{4} P_{0}^{n} \left(V_{1}^{n} - V_{-1}^{n} \right)
\end{multline}
and likewise for $j = J$. Just like the discretized Smoluchowski equation, these equations can be written in matrix form. The temperature is normalized by assuming that the energy remains fixed, this will be true as long as no heat or current flows through the boundaries, i.e. $J(x = a) = 0 = J(x = b)$ and $\frac{\partial T}{\partial x} \rvert_a = 0 = \frac{\partial T}{\partial x} \rvert_b$. In this case, the energy is constant and is given by $E = \int P(x) V(x) dx + c_p \int T(x) dx$, so each time that we step the temperature forward, we have to calculate the potential and thermal energy and then scale the temperature so that the total energy remains fixed.

Fortunately the matrices that we are dealing with are very sparse, so the program used to solve these equations can save on memory by calling sparse matrix libraries.

%\subsection{Stochastic methods}
%We can simulate the path of a single particle by using stochastic methods to solve the Langevin equation. By simulating many times we should be able to recover the distributions that were found through finite differencing. When simulating the system  at the microscopic level, equation (\ref{eqn:Smoluchowski}) becomes \cite{Reimann2001}

%\begin{equation}
%\gamma \dot{x}(t) = -V'(x(t)) + \xi(t)
%\end{equation}
%
%Where $\xi(t)$ is called Gaussian white noise of zero mean and has the essential properties that: $\langle \xi(t) \rangle = 0$ and $\langle \xi(t) \xi(s) \rangle = 2 \gamma k_B T \delta(t - s) $. We can also consider the stochastic equation with time discretized, in which case we get:
%
%\begin{equation}
%x(t_{n+1}) = x(t_n) - \Delta t [V'(x(t_n)) + \xi_n]/\gamma
%\end{equation}
%
%This equation can be simulated numerically, or can be used to derive Equation (\ref{eqn:Smoluchowski}) by taking the limit $\Delta t \to 0$ as is done in Appendix B of \cite{Reimann2001}. In the results section, we will show some results of these numerical simulations.
